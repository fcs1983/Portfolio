* Microsoft COBOL Version 5.0        L2.4 revision 003 02-Dec-15 23:59 Page   1
*                                        EM0403.CBL
* Options: LIST(EM0403.LST) ASMLIST(EM0403.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID.    EM0403.
     3 AUTHOR.        FABIO COSTA.
     4 INSTALLATION.  FATEC-SP.
     5 DATE-WRITTEN.  01/12/2015.
     6 DATE-COMPILED. 02-Dec-15 2.
     7 SECURITY.      NAO MODIFICAR SEM AUTORIZACAO.
     8*REMARKS.       REALIZAR A INTERCALACAO DOS ARQUIVOS DE ENTRADA,
     9*               GERANDO ARQUIVO DE SAIDA E RELATORIOS.
    10
    11 ENVIRONMENT DIVISION.
    12 CONFIGURATION SECTION.
    13 SOURCE-COMPUTER.  IBM-PC.
    14 OBJECT-COMPUTER.  IBM-PC.
    15 SPECIAL-NAMES.    DECIMAL-POINT IS COMMA.
    16
    17 INPUT-OUTPUT SECTION.
    18 FILE-CONTROL.
    19
    20     SELECT CADMERC ASSIGN TO DISK
    21     ORGANIZATION IS LINE SEQUENTIAL.
    22
    23     SELECT MOVMERC ASSIGN TO DISK
    24     ORGANIZATION IS LINE SEQUENTIAL.
    25
    26     SELECT ATUMERC ASSIGN TO DISK
    27     ORGANIZATION IS LINE SEQUENTIAL.
    28
    29     SELECT RELERRO ASSIGN TO DISK.
    30
    31     SELECT RELMERC ASSIGN TO DISK.
    32
    33 DATA DIVISION.
    34 FILE SECTION.
    35
    36 FD CADMERC
    37     LABEL RECORD ARE STANDARD
    38     VALUE OF FILE-ID IS "CADMERC.DAT".
    39
    40 01 REG-CAD.
    41     02 COD-CAD        PIC 9(03).
    42     02 DESC-CAD       PIC X(30).
    43     02 MIN-CAD        PIC 9(03).
    44     02 QTDE-CAD       PIC 9(03).
    45     02 PRECO-CAD      PIC 9(04)V99.
    46
    47 FD MOVMERC
    48     LABEL RECORD ARE STANDARD
    49     VALUE OF FILE-ID IS "MOVMERC.DAT".
    50
    51 01 REG-MOV.
    52     02 COD-MOV        PIC 9(03).
    53     02 DESC-MOV       PIC X(30).
    54     02 MIN-MOV        PIC 9(03).
    55     02 QTDE-MOV       PIC 9(03).
    56     02 PRECO-MOV      PIC 9(04)V99.
    57     02 TIPO-MOV       PIC X.
* Microsoft COBOL Version 5.0        L2.4 revision 003 02-Dec-15 23:59 Page   2
*                                        EM0403.CBL
    58
    59 FD ATUMERC
    60     LABEL RECORD ARE STANDARD
    61     VALUE OF FILE-ID IS "ATUMERC.DAT".
    62
    63 01 REG-ATU.
    64     02 COD-ATU        PIC 9(03).
    65     02 DESC-ATU       PIC X(30).
    66     02 MIN-ATU        PIC 9(03).
    67     02 QTDE-ATU       PIC 9(03).
    68     02 PRECO-ATU      PIC 9(04)V99.
    69
    70 FD RELERRO
    71     LABEL RECORD IS OMMITED.
    72
    73 01 REL-ERRO           PIC X(80).
    74
    75 FD RELMERC
    76     LABEL RECORD IS OMMITED.
    77
    78 01 REL-CRIT           PIC X(80).
    79
    80 WORKING-STORAGE SECTION.
    81
    82 77 CH-CAD             PIC X(03) VALUE SPACES.
    83 77 CH-MOV             PIC X(03) VALUE SPACES.
    84 77 CT-LIN1            PIC 9(02) VALUE 40.
    85 77 CT-LIN2            PIC 9(02) VALUE 40.
    86 77 CT-PAG1            PIC 9(02) VALUE ZEROES.
    87 77 CT-PAG2            PIC 9(02) VALUE ZEROES.
    88
    89 01 CAB-01.
    90     02 FILLER         PIC X(28) VALUE SPACES.
    91     02 FILLER         PIC X(22) VALUE "RELACAO DE MERCADORIAS".
    92     02 FILLER         PIC X(19) VALUE SPACES.
    93     02 FILLER         PIC X(04) VALUE "PAG.".
    94     02 VAR-PAG        PIC ZZ9.
    95     02 FILLER         PIC X(04) VALUE SPACES.
    96
    97 01 CAB-02.
    98     02 FILLER         PIC X(30) VALUE SPACES.
    99     02 FILLER         PIC X(20) VALUE "ERROS DE ATUALIZACAO".
   100     02 FILLER         PIC X(30) VALUE SPACES.
   101
   102 01 CAB-03.
   103     02 FILLER         PIC X(04) VALUE SPACES.
   104     02 FILLER         PIC X(06) VALUE "CODIGO".
   105     02 FILLER         PIC X(08) VALUE SPACES.
   106     02 FILLER         PIC X(09) VALUE "DESCRICAO".
   107     02 FILLER         PIC X(26) VALUE SPACES.
   108     02 FILLER         PIC X(08) VALUE "MENSAGEM".
   109     02 FILLER         PIC X(19) VALUE SPACES.
   110
   111 01 CAB-04.
   112     02 FILLER         PIC X(80) VALUE SPACES.
   113
   114 01 DETALHE1.
   115     02 FILLER         PIC X(06) VALUE SPACES.
* Microsoft COBOL Version 5.0        L2.4 revision 003 02-Dec-15 23:59 Page   3
*                                        EM0403.CBL
   116     02 CODIGO1        PIC 9(03).
   117     02 FILLER         PIC X(04) VALUE SPACES.
   118     02 DESCRICAO1     PIC X(30).
   119     02 FILLER         PIC X(04) VALUE SPACES.
   120     02 MENSAGEM       PIC X(30).
   121     02 FILLER         PIC X(03) VALUE SPACES.
   122
   123 01 CAB-05.
   124     02 FILLER         PIC X(32) VALUE SPACES.
   125     02 FILLER         PIC X(15) VALUE "ESTOQUE CRITICO".
   126     02 FILLER         PIC X(33) VALUE SPACES.
   127
   128 01 CAB-06.
   129     02 FILLER         PIC X(04) VALUE SPACES.
   130     02 FILLER         PIC X(06) VALUE "CODIGO".
   131     02 FILLER         PIC X(03) VALUE SPACES.
   132     02 FILLER         PIC X(09) VALUE "DESCRICAO".
   133     02 FILLER         PIC X(22) VALUE SPACES.
   134     02 FILLER         PIC X(07) VALUE "ESTOQUE".
   135     02 FILLER         PIC X(05) VALUE SPACES.
   136     02 FILLER         PIC X(10) VALUE "QUANTIDADE".
   137     02 FILLER         PIC X(03) VALUE SPACES.
   138     02 FILLER         PIC X(05) VALUE "PRECO".
   139     02 FILLER         PIC X(06) VALUE SPACES.
   140
   141 01 CAB-07.
   142     02 FILLER         PIC X(46) VALUE SPACES.
   143     02 FILLER         PIC X(06) VALUE "MINIMO".
   144     02 FILLER         PIC X(05) VALUE SPACES.
   145     02 FILLER         PIC X(07) VALUE "ESTOQUE".
   146     02 FILLER         PIC X(02) VALUE SPACES.
   147     02 FILLER         PIC X(08) VALUE "UNITARIO".
   148     02 FILLER         PIC X(06) VALUE SPACES.
   149
   150 01 DETALHE2.
   151     02 FILLER         PIC X(06) VALUE SPACES.
   152     02 CODIGO2        PIC 9(03).
   153     02 FILLER         PIC X(02) VALUE SPACES.
   154     02 DESCRICAO2     PIC X(30).
   155     02 FILLER         PIC X(05) VALUE SPACES.
   156     02 MINIMO         PIC 9(03).
   157     02 FILLER         PIC X(08) VALUE SPACES.
   158     02 QTDE           PIC 9(03).
   159     02 FILLER         PIC X(05) VALUE SPACES.
   160     02 PRECO          PIC Z.Z99,99.
   161     02 FILLER         PIC X(09) VALUE SPACES.
   162
   163 PROCEDURE DIVISION.
   164
   165 EM04-03.
   166     PERFORM INICIO.
   167     PERFORM PRINCIPAL UNTIL CH-CAD EQUAL CH-MOV AND
   168                             CH-MOV EQUAL HIGH-VALUES.
   169     PERFORM FIM.
   170     STOP RUN.
   171
   172 INICIO.
   173     OPEN INPUT  CADMERC
* Microsoft COBOL Version 5.0        L2.4 revision 003 02-Dec-15 23:59 Page   4
*                                        EM0403.CBL
   174                 MOVMERC
   175          OUTPUT ATUMERC
   176                 RELERRO
   177                 RELMERC.
   178     PERFORM LER-CAD.
   179     PERFORM LER-MOV.
   180
   181 LER-CAD.
   182     READ CADMERC AT END MOVE HIGH-VALUES TO CH-CAD.
   183     IF CH-CAD EQUAL HIGH-VALUES
   184         NEXT SENTENCE
   185     ELSE
   186         MOVE COD-CAD TO CH-CAD.
   187
   188 LER-MOV.
   189     READ MOVMERC AT END MOVE HIGH-VALUES TO CH-MOV.
   190     IF CH-MOV EQUAL HIGH-VALUES
   191         NEXT SENTENCE
   192     ELSE
   193         MOVE COD-MOV TO CH-MOV.
   194
   195 PRINCIPAL.
   196     IF CH-CAD EQUAL TO CH-MOV
   197         PERFORM IGUAL
   198         PERFORM LER-CAD
   199         PERFORM LER-MOV
   200     ELSE
   201         IF CH-CAD LESS CH-MOV
   202             PERFORM MENOR
   203             PERFORM LER-CAD
   204         ELSE
   205             PERFORM MAIOR
   206             PERFORM LER-MOV.
   207
   208 IGUAL.
   209     IF TIPO-MOV IS EQUAL TO 1
   210         MOVE COD-MOV  TO CODIGO1
   211         MOVE DESC-MOV TO DESCRICAO1
   212         MOVE "INCLUSAO DE REG. JA EXISTENTE" TO MENSAGEM
   213         PERFORM RELATERRO
   214         MOVE COD-CAD   TO COD-ATU
   215         MOVE DESC-CAD  TO DESC-ATU
   216         MOVE MIN-CAD   TO MIN-ATU
   217         MOVE QTDE-CAD  TO QTDE-ATU
   218         MOVE PRECO-CAD TO PRECO-ATU
   219         WRITE REG-ATU
   220         IF QTDE-CAD IS LESS THAN OR EQUAL TO MIN-CAD
   221             MOVE COD-CAD   TO CODIGO2
   222             MOVE DESC-CAD  TO DESCRICAO2
   223             MOVE MIN-CAD   TO MINIMO
   224             MOVE QTDE-CAD  TO QTDE
   225             MOVE PRECO-CAD TO PRECO
   226             PERFORM RELCRITICO
   227         END-IF
   228     ELSE
   229         IF TIPO-MOV IS EQUAL TO 2
   230             MOVE COD-MOV   TO COD-ATU
   231             MOVE DESC-MOV  TO DESC-ATU
* Microsoft COBOL Version 5.0        L2.4 revision 003 02-Dec-15 23:59 Page   5
*                                        EM0403.CBL
   232             MOVE MIN-MOV   TO MIN-ATU
   233             MOVE QTDE-MOV  TO QTDE-ATU
   234             MOVE PRECO-MOV TO PRECO-ATU
   235             WRITE REG-ATU
   236             IF QTDE-MOV IS LESS THAN OR EQUAL TO MIN-MOV
   237                 MOVE COD-MOV   TO CODIGO2
   238                 MOVE DESC-MOV  TO DESCRICAO2
   239                 MOVE MIN-MOV   TO MINIMO
   240                 MOVE QTDE-MOV  TO QTDE
   241                 MOVE PRECO-MOV TO PRECO
   242                 PERFORM RELCRITICO.
   243
   244 MENOR.
   245     MOVE COD-CAD   TO COD-ATU.
   246     MOVE DESC-CAD  TO DESC-ATU.
   247     MOVE MIN-CAD   TO MIN-ATU.
   248     MOVE QTDE-CAD  TO QTDE-ATU.
   249     MOVE PRECO-CAD TO PRECO-ATU.
   250     WRITE REG-ATU.
   251     IF QTDE-CAD IS LESS THAN OR EQUAL TO MIN-CAD
   252         MOVE COD-CAD   TO CODIGO2
   253         MOVE DESC-CAD  TO DESCRICAO2
   254         MOVE MIN-CAD   TO MINIMO
   255         MOVE QTDE-CAD  TO QTDE
   256         MOVE PRECO-CAD TO PRECO
   257         PERFORM RELCRITICO.
   258
   259 MAIOR.
   260     IF TIPO-MOV IS EQUAL TO 1
   261         MOVE COD-MOV   TO COD-ATU
   262         MOVE DESC-MOV  TO DESC-ATU
   263         MOVE MIN-MOV   TO MIN-ATU
   264         MOVE QTDE-MOV  TO QTDE-ATU
   265         MOVE PRECO-MOV TO PRECO-ATU
   266         WRITE REG-ATU
   267         IF QTDE-MOV IS LESS THAN OR EQUAL TO MIN-MOV
   268             MOVE COD-MOV   TO CODIGO2
   269             MOVE DESC-MOV  TO DESCRICAO2
   270             MOVE MIN-MOV   TO MINIMO
   271             MOVE QTDE-MOV  TO QTDE
   272             MOVE PRECO-MOV TO PRECO
   273             PERFORM RELCRITICO
   274         END-IF
   275     ELSE
   276         IF TIPO-MOV IS EQUAL TO 2
   277             MOVE COD-MOV  TO CODIGO1
   278             MOVE DESC-MOV TO DESCRICAO1
   279             MOVE "ALTERACAO DE REG. Ñ EXISTENTE" TO MENSAGEM
   280             PERFORM RELATERRO
   281         ELSE
   282             MOVE COD-MOV TO CODIGO1
   283             MOVE DESC-MOV TO DESCRICAO1
   284             MOVE "EXCLUSAO DE REG. Ñ EXISTENTE" TO MENSAGEM
   285             PERFORM RELATERRO.
   286
   287 RELATERRO.
   288     IF CT-LIN1 GREATER THAN 39
   289         PERFORM CABECALHOERRO.
* Microsoft COBOL Version 5.0        L2.4 revision 003 02-Dec-15 23:59 Page   6
*                                        EM0403.CBL
   290     PERFORM IMPERRO.
   291
   292 CABECALHOERRO.
   293     ADD 1 TO CT-PAG1.
   294     MOVE CT-PAG1 TO VAR-PAG.
   295     MOVE SPACES TO REL-ERRO.
   296     WRITE REL-ERRO AFTER ADVANCING PAGE.
   297     WRITE REL-ERRO FROM CAB-01 AFTER ADVANCING 1 LINE.
   298     WRITE REL-ERRO FROM CAB-02 AFTER ADVANCING 2 LINES.
   299     WRITE REL-ERRO FROM CAB-03 AFTER ADVANCING 2 LINES.
   300     WRITE REL-ERRO FROM CAB-04 AFTER ADVANCING 1 LINE.
   301     MOVE ZEROES TO CT-LIN1.
   302
   303 IMPERRO.
   304     WRITE REL-ERRO FROM DETALHE1 AFTER ADVANCING 1 LINE.
   305     ADD 1 TO CT-LIN1.
   306
   307 RELCRITICO.
   308     IF CT-LIN2 GREATER THAN 39
   309         PERFORM CABECALHOCRIT.
   310     PERFORM IMPCRIT.
   311
   312 CABECALHOCRIT.
   313     ADD 1 TO CT-PAG2.
   314     MOVE CT-PAG2 TO VAR-PAG.
   315     MOVE SPACES TO REL-CRIT.
   316     WRITE REL-CRIT AFTER ADVANCING PAGE.
   317     WRITE REL-CRIT FROM CAB-01 AFTER ADVANCING 1 LINE.
   318     WRITE REL-CRIT FROM CAB-05 AFTER ADVANCING 2 LINES.
   319     WRITE REL-CRIT FROM CAB-06 AFTER ADVANCING 2 LINES.
   320     WRITE REL-CRIT FROM CAB-07 AFTER ADVANCING 1 LINE.
   321     WRITE REL-CRIT FROM CAB-04 AFTER ADVANCING 1 LINE.
   322     MOVE ZEROES TO CT-LIN2.
   323
   324 IMPCRIT.
   325     WRITE REL-CRIT FROM DETALHE2 AFTER ADVANCING 1 LINE.
   326     ADD 1 TO CT-LIN2.
   327
   328 FIM.
   329     CLOSE CADMERC
   330           MOVMERC
   331           ATUMERC
   332           RELERRO
   333           RELMERC.
   334
   335
   336
   337
   338
   339
   340
   341
   342
   343
   344
   345
   346
   347
* Microsoft COBOL Version 5.0        L2.4 revision 003 02-Dec-15 23:59 Page   7
*                                        EM0403.CBL
   348
   349
   350
* Microsoft COBOL Version 5.0        L2.4 revision 003
* (C)Copyright Microsoft Corp 1984, 1993       URN AXUPA/ZZ0/00001
*                                              REF GNB-029052003A8
*
* Total Messages:     0
* Data:        2464     Code:        1871
