* Microsoft COBOL Version 5.0        L2.4 revision 003 14-Oct-15 03:39 Page   1
*                                        EM0206.CBL
* Options: LIST(EM0206.LST) ASMLIST(EM0206.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID.    EM0206.
     3 AUTHOR.        FABIO COSTA.
     4 INSTALLATION.  FATEC-SP.
     5 DATE-WRITTEN.  13/10/2015.
     6 DATE-COMPILED. 14-Oct-15 0.
     7 SECURITY.      NAO MODIFICAR SEM AUTORIZACAO.
     8*REMARKS.       LER OS REGISTROS E CADCLI CRITICA-LOS
     9*               MEDIANTE AS CONDICOES DADAS.
    10
    11 ENVIRONMENT DIVISION.
    12 CONFIGURATION SECTION.
    13 SOURCE-COMPUTER.  IBM-PC.
    14 OBJECT-COMPUTER.  IBM-PC.
    15 SPECIAL-NAMES.    DECIMAL-POINT IS COMMA.
    16
    17 INPUT-OUTPUT SECTION.
    18 FILE-CONTROL.
    19     SELECT CADCLI ASSIGN TO DISK
    20     ORGANIZATION IS LINE SEQUENTIAL.
    21
    22     SELECT CADOK ASSIGN TO DISK
    23     ORGANIZATION IS LINE SEQUENTIAL.
    24
    25     SELECT RELOCOR ASSIGN TO DISK.
    26
    27 DATA DIVISION.
    28 FILE SECTION.
    29
    30 FD CADCLI
    31     LABEL RECORD ARE STANDARD
    32     VALUE OF FILE-ID IS "CADCLI.DAT".
    33
    34 01 REGCLI.
    35     02 CODIGO-ENT     PIC X(03).
    36     02 CPF-ENT1.
    37         03 CPF-ENT        PIC 9 OCCURS 11 TIMES.
    38     02 NOME-ENT       PIC X(30).
    39     02 ESTADO-ENT     PIC X(02).
    40         88 ESTADO-VALIDO        VALUE "AC" "AL" "AP" "AM" "BA"
    41            "CE" "DF" "ES" "GO" "MA" "MT" "MS" "MG" "PA" "PB"
    42            "PR" "PE" "PI" "RJ" "RN" "RS" "RO" "RR" "SC" "SP"
    43            "SE" "TO".
    44
    45     02 CIDADE-ENT     PIC X(30).
    46     02 EMAIL-ENT      PIC X(30).
    47     02 TELEFONE-ENT   PIC 9(10).
    48
    49 FD CADOK
    50     LABEL RECORD ARE STANDARD
    51     VALUE OF FILE-ID IS "CADOK.DAT".
    52
    53 01 REGOK.
    54     02 CPF-SAI        PIC 9(11).
    55     02 NOME-SAI       PIC X(30).
    56     02 ESTADO-SAI     PIC X(02).
    57     02 CIDADE-SAI     PIC X(30).
* Microsoft COBOL Version 5.0        L2.4 revision 003 14-Oct-15 03:39 Page   2
*                                        EM0206.CBL
    58     02 EMAIL-SAI      PIC X(30).
    59     02 TELEFONE-SAI   PIC 9(10).
    60
    61 FD RELOCOR
    62     LABEL RECORD IS OMMITED.
    63
    64 01 REL-SAI            PIC X(80).
    65
    66 WORKING-STORAGE SECTION.
    67
    68 77 FIM-ARQ            PIC X(03) VALUE "NAO".
    69 77 CT-LIN             PIC 9(02) VALUE 40.
    70 77 CPF-SOMA1          PIC 9(04) VALUE ZEROES.
    71 77 CPF-SOMA2          PIC 9(04) VALUE ZEROES.
    72 77 CPF-DIV1           PIC 99    VALUE ZEROES.
    73 77 CPF-DIV2           PIC 99    VALUE ZEROES.
    74 77 CTR1               PIC 99    VALUE 1.
    75 77 CTR2               PIC 99    VALUE 10.
    76 77 CPF-RESTO1         PIC 99    VALUE ZEROES.
    77 77 CPF-RESTO2         PIC 99    VALUE ZEROES.
    78 77 CPF-VAL            PIC 9     VALUE ZEROES.
    79 77 NOME-VAL           PIC 9     VALUE ZEROES.
    80 77 ESTADO-VAL         PIC 9     VALUE ZEROES.
    81 77 CIDADE-VAL         PIC 9     VALUE ZEROES.
    82 77 EMAIL-VAL          PIC 9     VALUE ZEROES.
    83
    84 01 CAB-01.
    85     02 FILLER         PIC X(32) VALUE SPACES.
    86     02 FILLER         PIC X(17) VALUE "TURISMAR TURISMOS".
    87     02 FILLER         PIC X(32) VALUE SPACES.
    88
    89 01 CAB-02.
    90     02 FILLER         PIC X(17) VALUE SPACES.
    91     02 FILLER         PIC X(45) VALUE
    92                "RELATORIO DE DADOS DE CLIENTES INCONSISTENTES".
    93     02 FILLER         PIC X(18) VALUE SPACES.
    94
    95 01 CAB-03.
    96     02 FILLER         PIC X(17) VALUE "CODIGO DO CLIENTE".
    97     02 FILLER         PIC X(08) VALUE SPACES.
    98     02 FILLER         PIC X(15) VALUE "DADOS INVALIDOS".
    99     02 FILLER         PIC X(40) VALUE SPACES.
   100
   101 01 CAB-04.
   102     02 FILLER         PIC X(80) VALUE ALL "-".
   103
   104 01 CAB-05.
   105     02 FILLER         PIC X(80) VALUE SPACES.
   106
   107 01 DETALHE.
   108     02 FILLER         PIC X(08) VALUE SPACES.
   109     02 CODIGO         PIC XXX   VALUE SPACES.
   110     02 FILLER         PIC X(14) VALUE SPACES.
   111     02 MSGINVALIDO    PIC X(30).
   112     02 FILLER         PIC X(25) VALUE SPACES.
   113
   114 PROCEDURE DIVISION.
   115
* Microsoft COBOL Version 5.0        L2.4 revision 003 14-Oct-15 03:39 Page   3
*                                        EM0206.CBL
   116 EM02-06.
   117     PERFORM INICIO.
   118     PERFORM PRINCIPAL UNTIL FIM-ARQ EQUAL "SIM".
   119     PERFORM FIM.
   120     STOP RUN.
   121
   122 INICIO.
   123     OPEN INPUT  CADCLI
   124          OUTPUT CADOK
   125          OUTPUT RELOCOR.
   126     PERFORM LEITURA.
   127
   128 LEITURA.
   129     READ CADCLI AT END MOVE "SIM" TO FIM-ARQ.
   130
   131 PRINCIPAL.
   132     PERFORM VALIDACAO.
   133     IF CPF-VAL = 1 AND NOME-VAL = 1 AND ESTADO-VAL = 1 AND
   134                    CIDADE-VAL = 1 AND EMAIL-VAL = 1
   135         PERFORM GRAVACAO
   136     ELSE
   137         PERFORM IMPRESSAO.
   138     PERFORM LEITURA.
   139
   140 VALIDACAO.
   141     PERFORM VALIDACPF.
   142     PERFORM VALIDANOME.
   143     PERFORM VALIDAESTADO.
   144     PERFORM VALIDACIDADE.
   145     PERFORM VALIDAEMAIL.
   146
   147 VALIDACPF.
   148     PERFORM SOMA1 9 TIMES.
   149     MOVE 1  TO CTR1.
   150     MOVE 11 TO CTR2.
   151     PERFORM SOMA2 10 TIMES.
   152     MULTIPLY 10 BY CPF-SOMA1.
   153     DIVIDE 11 INTO CPF-SOMA1 GIVING CPF-DIV1
   154                              REMAINDER CPF-RESTO1.
   155     MULTIPLY 10 BY CPF-SOMA2.
   156     DIVIDE 11 INTO CPF-SOMA2 GIVING CPF-DIV2
   157                              REMAINDER CPF-RESTO2.
   158     IF CPF-RESTO1 IS EQUAL TO CPF-ENT(10) AND CPF-RESTO2
   159                                   IS EQUAL TO CPF-ENT(11) THEN
   160         MOVE 1 TO CPF-VAL
   161     ELSE
   162         MOVE 0 TO CPF-VAL.
   163
   164
   165 SOMA1.
   166     COMPUTE CPF-SOMA1 = CPF-SOMA1 + CPF-ENT(CTR1) * CTR2.
   167     ADD 1 TO CTR1.
   168     SUBTRACT 1 FROM CTR2.
   169
   170 SOMA2.
   171     COMPUTE CPF-SOMA2 = CPF-SOMA2 + CPF-ENT(CTR1) * CTR2.
   172     ADD 1 TO CTR1.
   173     SUBTRACT 1 FROM CTR2.
* Microsoft COBOL Version 5.0        L2.4 revision 003 14-Oct-15 03:39 Page   4
*                                        EM0206.CBL
   174
   175 VALIDANOME.
   176     IF NOME-ENT IS NOT EQUAL TO SPACES
   177         MOVE 1 TO NOME-VAL
   178     ELSE
   179         MOVE 0 TO NOME-VAL.
   180
   181 VALIDAESTADO.
   182     IF ESTADO-VALIDO
   183         MOVE 1 TO ESTADO-VAL
   184     ELSE
   185         MOVE 0 TO ESTADO-VAL.
   186
   187 VALIDACIDADE.
   188     IF CIDADE-ENT IS NOT EQUAL TO SPACES
   189         MOVE 1 TO CIDADE-VAL
   190     ELSE
   191         MOVE 0 TO CIDADE-VAL.
   192
   193 VALIDAEMAIL.
   194     IF EMAIL-ENT IS NOT EQUAL TO SPACES
   195         MOVE 1 TO EMAIL-VAL
   196     ELSE
   197         MOVE 0 TO EMAIL-VAL.
   198
   199 GRAVACAO.
   200     MOVE CPF-ENT1 TO CPF-SAI.
   201     MOVE NOME-ENT TO NOME-SAI.
   202     MOVE ESTADO-ENT TO ESTADO-SAI.
   203     MOVE CIDADE-ENT TO CIDADE-SAI.
   204     MOVE EMAIL-ENT TO EMAIL-SAI.
   205     MOVE TELEFONE-ENT TO TELEFONE-SAI.
   206     WRITE REGOK.
   207
   208 IMPRESSAO.
   209     IF CT-LIN IS GREATER THAN 39
   210         PERFORM CABECALHO.
   211     PERFORM IMPDET.
   212
   213 CABECALHO.
   214     MOVE SPACES TO REL-SAI.
   215     WRITE REL-SAI AFTER ADVANCING PAGE.
   216     WRITE REL-SAI FROM CAB-01 AFTER ADVANCING 1 LINE.
   217     WRITE REL-SAI FROM CAB-02 AFTER ADVANCING 2 LINES.
   218     WRITE REL-SAI FROM CAB-03 AFTER ADVANCING 2 LINES.
   219     WRITE REL-SAI FROM CAB-04 AFTER ADVANCING 1 LINE.
   220     WRITE REL-SAI FROM CAB-04 AFTER ADVANCING 1 LINE.
   221     MOVE ZEROES TO CT-LIN.
   222
   223 IMPDET.
   224     IF CPF-VAL = 0
   225         MOVE CODIGO-ENT TO CODIGO
   226         MOVE "CPF INVALIDO" TO MSGINVALIDO
   227         WRITE REL-SAI FROM DETALHE AFTER ADVANCING 1 LINE.
   228     IF NOME-VAL = 0
   229         IF CODIGO IS EQUAL TO SPACES
   230             MOVE CODIGO-ENT TO CODIGO
   231         ELSE
* Microsoft COBOL Version 5.0        L2.4 revision 003 14-Oct-15 03:39 Page   5
*                                        EM0206.CBL
   232             MOVE SPACES TO CODIGO
   233         MOVE "NOME NAO INFORMADO" TO MSGINVALIDO
   234         WRITE REL-SAI FROM DETALHE AFTER ADVANCING 1 LINE.
   235     IF ESTADO-VAL = 0
   236         IF CODIGO IS EQUAL TO SPACES
   237             MOVE CODIGO-ENT TO CODIGO
   238         ELSE
   239             MOVE SPACES TO CODIGO
   240         MOVE "ESTADO INVALIDO" TO MSGINVALIDO
   241         WRITE REL-SAI FROM DETALHE AFTER ADVANCING 1 LINE.
   242     IF CIDADE-VAL = 0
   243         IF CODIGO IS EQUAL TO SPACES
   244             MOVE CODIGO-ENT TO CODIGO
   245         ELSE
   246             MOVE SPACES TO CODIGO
   247         MOVE "CIDADE NAO INFORMADA" TO MSGINVALIDO
   248         WRITE REL-SAI FROM DETALHE AFTER ADVANCING 1 LINE.
   249     IF EMAIL-VAL = 0
   250         IF CODIGO IS EQUAL TO SPACES
   251             MOVE CODIGO-ENT TO CODIGO
   252         ELSE
   253             MOVE SPACES TO CODIGO
   254         MOVE "EMAIL SEM DESCRICAO" TO MSGINVALIDO
   255         WRITE REL-SAI FROM DETALHE AFTER ADVANCING 1 LINE.
   256     ADD 1 TO CT-LIN.
   257
   258 FIM.
   259     CLOSE CADCLI
   260           CADOK
   261           RELOCOR.
   262
   263
   264
   265
   266
   267
   268
   269
   270
   271
   272
   273
   274
   275
   276
   277
   278
* Microsoft COBOL Version 5.0        L2.4 revision 003
* (C)Copyright Microsoft Corp 1984, 1993       URN AXUPA/ZZ0/00001
*                                              REF GNB-029052003A8
*
* Total Messages:     0
* Data:        1908     Code:        1753
