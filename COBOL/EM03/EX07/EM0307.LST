* Microsoft COBOL Version 4.5        L2.4 revision 002 11-Nov-15 15:35 Page   1
*                                      EM0307.CBL
* Options: LIST(EM0307.LST) ASMLIST(EM0307.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID.    EM0307.
     3 AUTHOR.        FABIO COSTA.
     4 INSTALLATION.  FATEC-SP.
     5 DATE-WRITTEN.  10/11/2015.
     6 DATE-COMPILED. 11-Nov-15 15:35.
     7 SECURITY.      NAO MODIFICAR SEM AUTORIZACAO.
     8*REMARKS.       CLASSIFICAR CADALU EM ORDEM ASCENDENTE POR
     9*               TURMA E CODIGO, CALCULAR A MEDIA E
    10*               IMPRIMIR RELATORIO.
    11
    12 ENVIRONMENT DIVISION.
    13 CONFIGURATION SECTION.
    14 OBJECT-COMPUTER.  IBM-PC.
    15 SOURCE-COMPUTER.  IBM-PC.
    16 SPECIAL-NAMES.    DECIMAL-POINT IS COMMA.
    17
    18 INPUT-OUTPUT SECTION.
    19 FILE-CONTROL.
    20     SELECT CADALU ASSIGN TO DISK
    21     ORGANIZATION IS LINE SEQUENTIAL.
    22
    23     SELECT TRAB ASSIGN TO DISK.
    24
    25     SELECT RELALU ASSIGN TO DISK.
    26
    27 DATA DIVISION.
    28 FILE SECTION.
    29
    30 FD CADALU
    31     LABEL RECORD ARE STANDARD
    32     VALUE OF FILE-ID IS "CADALU.DAT".
    33
    34 01 REG-ENT.
    35     02 TURMA-ENT      PIC 9(03).
    36     02 COD-ENT        PIC 9(07).
    37     02 NOME-ENT       PIC X(30).
    38     02 NOTA-ENT.
    39         03 NOTA1-ENT  PIC 99V99.
    40         03 NOTA2-ENT  PIC 99V99.
    41         03 NOTA3-ENT  PIC 99V99.
    42         03 NOTA4-ENT  PIC 99V99.
    43
    44 SD TRAB.
    45
    46 01 REG-TRAB.
    47     02 TURMA-TRAB     PIC 9(03).
    48     02 COD-TRAB       PIC 9(07).
    49     02 NOME-TRAB      PIC X(30).
    50     02 NOTA-TRAB.
    51         03 NOTA1-TRAB PIC 99V99.
    52         03 NOTA2-TRAB PIC 99V99.
    53         03 NOTA3-TRAB PIC 99V99.
    54         03 NOTA4-TRAB PIC 99V99.
    55
    56 FD RELALU
    57     LABEL RECORD IS OMMITED.
* Microsoft COBOL Version 4.5        L2.4 revision 002 11-Nov-15 15:35 Page   2
*                                      EM0307.CBL
    58
    59 01 REG-REL            PIC X(80).
    60
    61 WORKING-STORAGE SECTION.
    62
    63 77 FIM-ARQ            PIC X(03)  VALUE "NAO".
    64 77 CT-LIN             PIC 9(02)  VALUE 40.
    65 77 CT-PAG             PIC 9(02)  VALUE ZEROES.
    66 77 CT-TURMA           PIC 9(03)  VALUE ZEROES.
    67 77 M-SOMA             PIC 99V99  VALUE ZEROES.
    68 77 MEDIA-ALU          PIC 99V99  VALUE ZEROES.
    69 77 CT-APROV           PIC 99     VALUE ZEROES.
    70 77 CT-REPROV          PIC 99     VALUE ZEROES.
    71 77 MEDIA-GERAL        PIC 99V99  VALUE ZEROES.
    72 77 SOMA-GERAL         PIC 999V99 VALUE ZEROES.
    73 77 TOT-ALU            PIC 99 VALUE ZEROES.
    74
    75 01 CAB-01.
    76     02 FILLER         PIC X(15) VALUE SPACES.
    77     02 FILLER         PIC X(17) VALUE "RELACAO DE ALUNOS".
    78     02 FILLER         PIC X(20) VALUE SPACES.
    79     02 FILLER         PIC X(05) VALUE "PAG. ".
    80     02 VAR-PAG        PIC ZZ9.
    81     02 FILLER         PIC X(20) VALUE SPACES.
    82
    83 01 CAB-02.
    84     02 FILLER         PIC X(05) VALUE SPACES.
    85     02 FILLER         PIC X(07) VALUE "TURMA: ".
    86     02 TURMA          PIC 9(03).
    87
    88 01 CAB-03.
    89     02 FILLER         PIC X(05) VALUE SPACES.
    90     02 FILLER         PIC X(06) VALUE "CODIGO".
    91     02 FILLER         PIC X(22) VALUE SPACES.
    92     02 FILLER         PIC X(04) VALUE "NOME".
    93     02 FILLER         PIC X(20) VALUE SPACES.
    94     02 FILLER         PIC X(05) VALUE "MEDIA".
    95     02 FILLER         PIC X(18) VALUE SPACES.
    96
    97 01 CAB-04.
    98     02 FILLER         PIC X(80) VALUE SPACES.
    99
   100 01 DETALHE.
   101     02 FILLER         PIC X(05) VALUE SPACES.
   102     02 CODIGO         PIC 9(07).
   103     02 FILLER         PIC X(06) VALUE SPACES.
   104     02 NOME           PIC X(30).
   105     02 FILLER         PIC X(09) VALUE SPACES.
   106     02 MEDIA          PIC 99,99.
   107     02 FILLER         PIC X(19) VALUE SPACES.
   108
   109 01 TOTAL-01.
   110     02 FILLER         PIC X(20) VALUE SPACES.
   111     02 FILLER         PIC X(25) VALUE
   112                                 "TOTAL DE ALUNOS APROVADOS".
   113     02 FILLER         PIC X(05) VALUE SPACES.
   114     02 APROVADOS      PIC 99.
   115     02 FILLER         PIC X(28) VALUE SPACES.
* Microsoft COBOL Version 4.5        L2.4 revision 002 11-Nov-15 15:35 Page   3
*                                      EM0307.CBL
   116
   117 01 TOTAL-02.
   118     02 FILLER         PIC X(20) VALUE SPACES.
   119     02 FILLER         PIC X(26) VALUE
   120                                 "TOTAL DE ALUNOS REPROVADOS".
   121     02 FILLER         PIC X(04) VALUE SPACES.
   122     02 REPROVADOS     PIC 99.
   123     02 FILLER         PIC X(28) VALUE SPACES.
   124
   125 01 MEDIA-01.
   126     02 FILLER         PIC X(20) VALUE SPACES.
   127     02 FILLER         PIC X(11) VALUE "MEDIA GERAL".
   128     02 FILLER         PIC X(19) VALUE SPACES.
   129     02 MEDIA-TOT      PIC 99,99.
   130     02 FILLER         PIC X(26) VALUE SPACES.
   131
   132 PROCEDURE DIVISION.
   133
   134 EM03-07.
   135     SORT TRAB
   136         ASCENDING KEY TURMA-TRAB
   137         ASCENDING KEY COD-TRAB
   138         USING CADALU
   139         OUTPUT PROCEDURE ROT-SAIDA.
   140     STOP RUN.
   141
   142 ROT-SAIDA SECTION.
   143     PERFORM INICIO.
   144     PERFORM PRINCIPAL UNTIL FIM-ARQ EQUAL "SIM".
   145     PERFORM FIM.
   146
   147 INICIO SECTION.
   148     OPEN OUTPUT RELALU.
   149     PERFORM LE-SORT.
   150     MOVE TURMA-TRAB TO CT-TURMA.
   151
   152 LE-SORT SECTION.
   153     RETURN TRAB AT END MOVE "SIM" TO FIM-ARQ.
   154     ADD 1 TO TOT-ALU.
   155
   156 PRINCIPAL SECTION.
   157     PERFORM IMPRESSAO.
   158     PERFORM LE-SORT.
   159
   160 IMPRESSAO SECTION.
   161     IF CT-LIN GREATER THAN 39
   162         PERFORM CABECALHO.
   163     IF CT-TURMA EQUAL TO TURMA-TRAB
   164         PERFORM C-MEDIA
   165         PERFORM IMP-DET
   166     ELSE
   167         PERFORM IMP-TOTAL
   168         MOVE TURMA-TRAB TO CT-TURMA
   169         PERFORM CABECALHO
   170         PERFORM C-MEDIA
   171         PERFORM IMP-DET.
   172
   173
* Microsoft COBOL Version 4.5        L2.4 revision 002 11-Nov-15 15:35 Page   4
*                                      EM0307.CBL
   174 CABECALHO SECTION.
   175     ADD 1 TO CT-PAG.
   176     MOVE CT-PAG TO VAR-PAG.
   177     MOVE CT-TURMA TO TURMA.
   178     MOVE SPACES TO REG-REL.
   179     WRITE REG-REL AFTER ADVANCING PAGE.
   180     WRITE REG-REL FROM CAB-01 AFTER ADVANCING 1 LINE.
   181     WRITE REG-REL FROM CAB-02 AFTER ADVANCING 2 LINES.
   182     WRITE REG-REL FROM CAB-03 AFTER ADVANCING 2 LINES.
   183     WRITE REG-REL FROM CAB-04 AFTER ADVANCING 1 LINES.
   184     MOVE ZEROES TO CT-LIN.
   185
   186 C-MEDIA SECTION.
   187     ADD NOTA1-TRAB NOTA2-TRAB NOTA3-TRAB NOTA4-TRAB
   188                                                GIVING M-SOMA.
   189     DIVIDE M-SOMA BY 4 GIVING MEDIA-ALU.
   190     IF MEDIA-ALU IS GREATER THAN OR EQUAL TO 7,0
   191         ADD 1 TO CT-APROV.
   192     IF MEDIA-ALU IS LESS THAN 7,0
   193         ADD 1 TO CT-REPROV.
   194     ADD MEDIA-ALU TO SOMA-GERAL.
   195
   196 IMP-DET SECTION.
   197     MOVE COD-TRAB  TO CODIGO.
   198     MOVE NOME-TRAB TO NOME.
   199     MOVE MEDIA-ALU TO MEDIA.
   200     WRITE REG-REL FROM DETALHE AFTER ADVANCING 1 LINE.
   201     ADD 1 TO CT-LIN.
   202
   203 IMP-TOTAL SECTION.
   204     MOVE CT-APROV  TO APROVADOS.
   205     MOVE CT-REPROV TO REPROVADOS.
   206     DIVIDE SOMA-GERAL BY TOT-ALU GIVING MEDIA-GERAL.
   207     MOVE MEDIA-GERAL TO MEDIA-TOT.
   208     WRITE REG-REL FROM TOTAL-01 AFTER ADVANCING 2 LINES.
   209     WRITE REG-REL FROM TOTAL-02 AFTER ADVANCING 1 LINE.
   210     WRITE REG-REL FROM MEDIA-01 AFTER ADVANCING 1 LINE.
   211     MOVE ZEROES TO CT-APROV.
   212     MOVE ZEROES TO CT-REPROV.
   213     MOVE ZEROES TO SOMA-GERAL.
   214     MOVE ZEROES TO TOT-ALU.
   215     MOVE ZEROES TO MEDIA-GERAL.
   216
   217 FIM SECTION.
   218     PERFORM IMP-TOTAL.
   219     CLOSE RELALU.
   220
   221
   222
   223
   224
   225
   226
   227
   228
   229
   230
   231
* Microsoft COBOL Version 4.5        L2.4 revision 002 11-Nov-15 15:35 Page   5
*                                      EM0307.CBL
   232
   233
   234
   235
   236
   237
   238
   239
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        2024     Code:        1076     Dictionary:        3229
