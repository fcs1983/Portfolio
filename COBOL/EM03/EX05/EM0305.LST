* Microsoft COBOL Version 5.0        L2.4 revision 003 11-Nov-15 23:53 Page   1
*                                        EM0305.CBL
* Options: LIST(EM0305.LST) ASMLIST(EM0305.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID.    EM0305.
     3 AUTHOR.        FABIO COSTA.
     4 INSTALLATION.  FATEC-SP.
     5 DATE-WRITTEN.  11/11/2015.
     6 DATE-COMPILED. 11-Nov-15 2.
     7 SECURITY.      NAO MODIFICAR SEM AUTORIZACAO.
     8*REMARKS.       GERAR UM RELATORIO CLASSIFICADO EM ORDEM
     9*               ASCENDENTE POR ESTADO E NUMERO DO VENDEDOR.
    10
    11 ENVIRONMENT DIVISION.
    12 CONFIGURATION SECTION.
    13 OBJECT-COMPUTER.  IBM-PC.
    14 SOURCE-COMPUTER.  IBM-PC.
    15 SPECIAL-NAMES.    DECIMAL-POINT IS COMMA.
    16
    17 INPUT-OUTPUT SECTION.
    18 FILE-CONTROL.
    19     SELECT ARQVENDA ASSIGN TO DISK
    20     ORGANIZATION IS LINE SEQUENTIAL.
    21
    22     SELECT TRAB ASSIGN TO DISK.
    23
    24     SELECT RELVENDA ASSIGN TO DISK.
    25
    26 DATA DIVISION.
    27 FILE SECTION.
    28
    29 FD ARQVENDA
    30     LABEL RECORD ARE STANDARD
    31     VALUE OF FILE-ID IS "ARQVENDA.DAT".
    32
    33 01 REG-ENT.
    34     02 ESTADO-ENT     PIC X(02).
    35     02 NR-ENT         PIC 9(05).
    36     02 NOME-ENT       PIC X(20).
    37     02 VALOR-ENT      PIC 9(07)V99.
    38
    39 SD TRAB.
    40
    41 01 REG-TRAB.
    42     02 ESTADO-TRAB    PIC X(02).
    43     02 NR-TRAB        PIC 9(05).
    44     02 NOME-TRAB      PIC X(20).
    45     02 VALOR-TRAB     PIC 9(07)V99.
    46
    47 FD RELVENDA
    48     LABEL RECORD IS OMMITED.
    49
    50 01 REG-REL            PIC X(80).
    51
    52 WORKING-STORAGE SECTION.
    53
    54 77 FIM-ARQ            PIC X(03) VALUE "NAO".
    55 77 CT-LIN             PIC 9(02) VALUE 20.
    56 77 CT-PAG             PIC 9(02) VALUE ZEROES.
    57 77 SET-EST            PIC X(02) VALUE SPACES.
* Microsoft COBOL Version 5.0        L2.4 revision 003 11-Nov-15 23:53 Page   2
*                                        EM0305.CBL
    58 77 SET-NUM            PIC 9(05) VALUE ZEROES.
    59 77 TOT-VEND           PIC 9(07)V99 VALUE ZEROES.
    60 77 TOT-COMP           PIC 9(07)V99 VALUE ZEROES.
    61 77 TOT-EST            PIC 9(07)V99 VALUE ZEROES.
    62
    63 01 CAB-01.
    64     02 FILLER         PIC X(15) VALUE SPACES.
    65     02 FILLER         PIC X(35) VALUE
    66                       "VENDAS TOTAIS POR ESTADO - VENDEDOR".
    67     02 FILLER         PIC X(10) VALUE SPACES.
    68     02 FILLER         PIC X(05) VALUE "PAG. ".
    69     02 VAR-PAG        PIC Z99.
    70     02 FILLER         PIC X(12) VALUE SPACES.
    71
    72 01 CAB-02.
    73     02 FILLER          PIC X(02) VALUE SPACES.
    74     02 FILLER          PIC X(08) VALUE "ESTADO: ".
    75     02 VAR-EST         PIC X(20) VALUE "SAO PAULO".
    76     02 FILLER          PIC X(50) VALUE SPACES.
    77
    78 01 CAB-03.
    79     02 FILLER         PIC X(05) VALUE SPACES.
    80     02 FILLER         PIC X(15) VALUE "NRO DO VENDEDOR".
    81     02 FILLER         PIC X(08) VALUE SPACES.
    82     02 FILLER         PIC X(16) VALUE "NOME DO VENDEDOR".
    83     02 FILLER         PIC X(12) VALUE SPACES.
    84     02 FILLER         PIC X(14) VALUE "VALOR DA VENDA".
    85     02 FILLER         PIC X(10) VALUE SPACES.
    86
    87 01 DETALHE.
    88     02 FILLER         PIC X(08) VALUE SPACES.
    89     02 NRO            PIC X(05) VALUE SPACES.
    90     02 FILLER         PIC X(16) VALUE SPACES.
    91     02 NOME           PIC X(15) VALUE SPACES.
    92     02 FILLER         PIC X(13) VALUE SPACES.
    93     02 VALOR          PIC ZZZZZ99,99.
    94     02 FILLER         PIC X(14) VALUE SPACES.
    95
    96 01 TOTAL-01.
    97     02 FILLER         PIC X(36) VALUE SPACES.
    98     02 FILLER         PIC X(19) VALUE "TOTAL DO VENDEDOR: ".
    99     02 TOT-V          PIC ZZZZZ99,99.
   100     02 FILLER         PIC X(16) VALUE SPACES.
   101
   102 01 TOTAL-02.
   103     02 FILLER         PIC X(36) VALUE SPACES.
   104     02 FILLER         PIC X(20) VALUE "TOTAL DO ESTADO:    ".
   105     02 TOT-E          PIC ZZZZZ99,99.
   106     02 FILLER         PIC X(15) VALUE SPACES.
   107
   108 01 TOTAL-03.
   109     02 FILLER         PIC X(36) VALUE SPACES.
   110     02 FILLER         PIC X(20) VALUE "TOTAL DA COMPANHIA: ".
   111     02 TOT-C          PIC ZZZZZ99,99.
   112     02 FILLER         PIC X(15) VALUE SPACES.
   113
   114 PROCEDURE DIVISION.
   115
* Microsoft COBOL Version 5.0        L2.4 revision 003 11-Nov-15 23:53 Page   3
*                                        EM0305.CBL
   116 EM03-05.
   117     SORT TRAB
   118         ASCENDING KEY ESTADO-TRAB
   119         ASCENDING KEY NR-TRAB
   120         USING ARQVENDA
   121         OUTPUT PROCEDURE ROT-SAIDA.
   122     STOP RUN.
   123
   124 ROT-SAIDA SECTION.
   125     PERFORM INICIO.
   126     PERFORM PRINCIPAL UNTIL FIM-ARQ EQUAL "SIM".
   127     PERFORM IMP-TOTAL.
   128     PERFORM FIM.
   129
   130 INICIO SECTION.
   131     OPEN OUTPUT RELVENDA.
   132     PERFORM LEITURA.
   133     MOVE ESTADO-TRAB TO SET-EST.
   134     MOVE NR-TRAB TO SET-NUM.
   135
   136 LEITURA SECTION.
   137     RETURN TRAB AT END MOVE "SIM" TO FIM-ARQ.
   138     ADD VALOR-TRAB TO TOT-COMP.
   139
   140 PRINCIPAL SECTION.
   141     PERFORM IMPRESSAO.
   142     PERFORM LEITURA.
   143
   144 IMPRESSAO SECTION.
   145     IF CT-LIN IS GREATER THAN 19
   146         PERFORM CABECALHO.
   147     IF ESTADO-TRAB IS EQUAL TO "SP"
   148         IF NR-TRAB IS EQUAL TO SET-NUM
   149             PERFORM IMP-DET
   150         ELSE
   151             PERFORM IMP-TOT-V
   152             MOVE ZEROES TO TOT-VEND
   153             MOVE NR-TRAB TO SET-NUM
   154             PERFORM IMP-DET.
   155
   156
   157 CABECALHO SECTION.
   158     ADD 1 TO CT-PAG.
   159     MOVE CT-PAG TO VAR-PAG.
   160     MOVE SPACES TO REG-REL.
   161     WRITE REG-REL AFTER ADVANCING PAGE.
   162     WRITE REG-REL FROM CAB-01 AFTER ADVANCING 1 LINE.
   163     WRITE REG-REL FROM CAB-02 AFTER ADVANCING 2 LINES.
   164     WRITE REG-REL FROM CAB-03 AFTER ADVANCING 2 LINES.
   165     MOVE ZEROES TO CT-LIN.
   166
   167 IMP-DET SECTION.
   168         IF NRO IS EQUAL TO SPACES
   169             MOVE NR-TRAB TO NRO
   170         ELSE
   171             MOVE SPACES TO NRO.
   172         IF NOME IS EQUAL TO SPACES
   173             MOVE NOME-TRAB TO NOME
* Microsoft COBOL Version 5.0        L2.4 revision 003 11-Nov-15 23:53 Page   4
*                                        EM0305.CBL
   174         ELSE
   175             MOVE SPACES TO NOME.
   176         MOVE VALOR-TRAB TO VALOR.
   177         ADD VALOR-TRAB TO TOT-VEND.
   178         ADD VALOR-TRAB TO TOT-EST.
   179         WRITE REG-REL FROM DETALHE AFTER ADVANCING 1 LINE.
   180         ADD 1 TO CT-LIN.
   181
   182 IMP-TOTAL SECTION.
   183     PERFORM IMP-TOT-V.
   184     MOVE TOT-EST TO TOT-E.
   185     MOVE TOT-COMP TO TOT-C.
   186     WRITE REG-REL FROM TOTAL-02 AFTER ADVANCING 2 LINES.
   187     WRITE REG-REL FROM TOTAL-03 AFTER ADVANCING 2 LINES.
   188
   189 IMP-TOT-V SECTION.
   190     MOVE SPACES TO NRO.
   191     MOVE SPACES TO NOME.
   192     MOVE TOT-VEND TO TOT-V.
   193     WRITE REG-REL FROM TOTAL-01 AFTER ADVANCING 2 LINES.
   194
   195 FIM SECTION.
   196     CLOSE RELVENDA.
   197
   198
   199
   200
   201
   202
   203
   204
   205
   206
   207
   208
   209
   210
   211
   212
   213
   214
   215
   216
   217
   218
   219
   220
   221
   222
   223
   224
   225
* Microsoft COBOL Version 5.0        L2.4 revision 003
* (C)Copyright Microsoft Corp 1984, 1993       URN AXUPA/ZZ0/00001
*                                              REF GNB-029052003A8
*
* Total Messages:     0
* Data:        1832     Code:        1096
