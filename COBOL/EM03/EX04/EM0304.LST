* Microsoft COBOL Version 5.0        L2.4 revision 003 10-Nov-15 23:12 Page   1
*                                        EM0304.CBL
* Options: LIST(EM0304.LST) ASMLIST(EM0304.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID.    EM0304.
     3 AUTHOR.        FABIO COSTA.
     4 DATE-WRITTEN.  10/11/2015.
     5 DATE-COMPILED. 10-Nov-15 2.
     6 SECURITY.      NAO MODIFICAR SEM AUTORIZACAO.
     7*REMARKS.       GERAR UM RELATORIO ORDENADO PELO CPF DO
     8*               CLIENTE.
     9
    10 ENVIRONMENT DIVISION.
    11 CONFIGURATION SECTION.
    12 OBJECT-COMPUTER.  IBM-PC.
    13 SOURCE-COMPUTER.  IBM-PC.
    14 SPECIAL-NAMES.    DECIMAL-POINT IS COMMA.
    15
    16 INPUT-OUTPUT SECTION.
    17 FILE-CONTROL.
    18     SELECT CADCLI ASSIGN TO DISK
    19     ORGANIZATION IS LINE SEQUENTIAL.
    20
    21     SELECT TRAB ASSIGN TO DISK.
    22
    23     SELECT RELAT ASSIGN TO DISK.
    24
    25 DATA DIVISION.
    26 FILE SECTION.
    27
    28 FD CADCLI
    29     LABEL RECORD ARE STANDARD
    30     VALUE OF FILE-ID IS "CADCLI.DAT".
    31
    32 01 REG-ENT.
    33     02 COD-ENT        PIC 9(03).
    34     02 CPF-ENT        PIC 9(11).
    35     02 NOME-ENT       PIC X(30).
    36     02 ESTADO-ENT     PIC X(02).
    37     02 CIDADE-ENT     PIC X(30).
    38     02 EMAIL-ENT      PIC X(30).
    39
    40 SD TRAB.
    41
    42 01 REG-TRAB.
    43     02 COD-TRAB       PIC 9(03).
    44     02 CPF-TRAB       PIC 9(11).
    45     02 NOME-TRAB      PIC X(30).
    46     02 ESTADO-TRAB    PIC X(02).
    47     02 CIDADE-TRAB    PIC X(30).
    48     02 EMAIL-TRAB     PIC X(30).
    49
    50 FD RELAT
    51     LABEL RECORD IS OMITTED.
    52
    53 01 REG-REL            PIC X(80).
    54
    55 WORKING-STORAGE SECTION.
    56
    57 77 FIM-ARQ            PIC X(03) VALUE "NAO".
* Microsoft COBOL Version 5.0        L2.4 revision 003 10-Nov-15 23:12 Page   2
*                                        EM0304.CBL
    58 77 CT-LIN             PIC 9(02) VALUE 20.
    59 77 CT-PAG             PIC 9(02) VALUE ZEROES.
    60 77 SET-EST            PIC X(02) VALUE "SP".
    61 77 SET-CID            PIC X(30) VALUE "SAO PAULO".
    62
    63 01 CAB-01.
    64     02 FILLER         PIC X(25) VALUE SPACES.
    65     02 FILLER         PIC X(37) VALUE
    66         "RELACAO DE CLIENTES POR ESTADO/CIDADE".
    67     02 FILLER         PIC X(10) VALUE SPACES.
    68     02 FILLER         PIC X(05) VALUE "PAG. ".
    69     02 VAR-PAG        PIC ZZ9.
    70
    71 01 CAB-02.
    72     02 FILLER         PIC X(05) VALUE SPACES.
    73     02 FILLER         PIC X(08) VALUE "ESTADO: ".
    74     02 VAR-EST        PIC X(02).
    75     02 FILLER         PIC X(65) VALUE SPACES.
    76
    77 01 CAB-03.
    78     02 FILLER         PIC X(05) VALUE SPACES.
    79     02 FILLER         PIC X(08) VALUE "CIDADE: ".
    80     02 VAR-CID        PIC X(30).
    81     02 FILLER         PIC X(37) VALUE SPACES.
    82
    83 01 CAB-04.
    84     02 FILLER         PIC X(02) VALUE SPACES.
    85     02 FILLER         PIC X(03) VALUE "CPF".
    86     02 FILLER         PIC X(20) VALUE SPACES.
    87     02 FILLER         PIC X(04) VALUE "NOME".
    88     02 FILLER         PIC X(15) VALUE SPACES.
    89     02 FILLER         PIC X(05) VALUE "EMAIL".
    90     02 FILLER         PIC X(31) VALUE SPACES.
    91
    92 01 CAB-05.
    93     02 FILLER         PIC X(80) VALUE SPACES.
    94
    95 01 DETALHE.
    96     02 FILLER         PIC X(02) VALUE SPACES.
    97     02 CPF            PIC 9(11).
    98     02 FILLER         PIC X(04) VALUE SPACES.
    99     02 NOME           PIC X(30).
   100     02 FILLER         PIC X(03) VALUE SPACES.
   101     02 EMAIL          PIC X(30).
   102
   103 PROCEDURE DIVISION.
   104
   105 EM03-04.
   106     SORT TRAB
   107          ASCENDING KEY CPF-TRAB
   108          INPUT  PROCEDURE ROT-ENTRADA
   109          OUTPUT PROCEDURE ROT-SAIDA.
   110     STOP RUN.
   111
   112 ROT-ENTRADA SECTION.
   113     PERFORM INICIO-ENTRADA.
   114     PERFORM PRINCIPAL-ENTRADA UNTIL FIM-ARQ EQUAL "SIM".
   115     PERFORM FIM-ENTRADA.
* Microsoft COBOL Version 5.0        L2.4 revision 003 10-Nov-15 23:12 Page   3
*                                        EM0304.CBL
   116
   117 INICIO-ENTRADA SECTION.
   118     OPEN INPUT CADCLI.
   119     PERFORM LEITURA-ENTRADA.
   120
   121 LEITURA-ENTRADA SECTION.
   122     READ CADCLI AT END MOVE "SIM" TO FIM-ARQ.
   123
   124 PRINCIPAL-ENTRADA SECTION.
   125     PERFORM SELECAO-ENTRADA.
   126     PERFORM LEITURA-ENTRADA.
   127
   128 SELECAO-ENTRADA SECTION.
   129     IF ESTADO-ENT EQUAL TO SET-EST AND
   130                            CIDADE-ENT EQUAL TO SET-CID
   131         PERFORM GRAVACAO-ENTRADA.
   132
   133 GRAVACAO-ENTRADA SECTION.
   134     MOVE COD-ENT TO COD-TRAB.
   135     MOVE CPF-ENT TO CPF-TRAB.
   136     MOVE NOME-ENT TO NOME-TRAB.
   137     MOVE ESTADO-ENT TO ESTADO-TRAB.
   138     MOVE CIDADE-ENT TO CIDADE-TRAB.
   139     MOVE EMAIL-ENT TO EMAIL-TRAB.
   140     RELEASE REG-TRAB.
   141
   142 FIM-ENTRADA SECTION.
   143     CLOSE CADCLI.
   144
   145 ROT-SAIDA SECTION.
   146     PERFORM INICIO-SAIDA.
   147     PERFORM PRINCIPAL-SAIDA UNTIL FIM-ARQ EQUAL "SIM".
   148     PERFORM FIM-SAIDA.
   149
   150 INICIO-SAIDA SECTION.
   151     MOVE "NAO" TO FIM-ARQ.
   152     OPEN OUTPUT RELAT.
   153     PERFORM LE-SAIDA.
   154
   155 LE-SAIDA SECTION.
   156     RETURN TRAB AT END MOVE "SIM" TO FIM-ARQ.
   157
   158 PRINCIPAL-SAIDA SECTION.
   159     PERFORM IMPRESSAO-SAIDA.
   160     PERFORM LE-SAIDA.
   161
   162 IMPRESSAO-SAIDA SECTION.
   163     IF CT-LIN GREATER THAN 19
   164         PERFORM CABECALHO-SAIDA.
   165     PERFORM DETALHE-SAIDA.
   166
   167 CABECALHO-SAIDA SECTION.
   168     ADD 1 TO CT-PAG.
   169     MOVE CT-PAG TO VAR-PAG.
   170     MOVE SET-EST TO VAR-EST.
   171     MOVE SET-CID TO VAR-CID.
   172     MOVE SPACES TO REG-REL.
   173     WRITE REG-REL AFTER ADVANCING PAGE.
* Microsoft COBOL Version 5.0        L2.4 revision 003 10-Nov-15 23:12 Page   4
*                                        EM0304.CBL
   174     WRITE REG-REL FROM CAB-01 AFTER ADVANCING 1 LINE.
   175     WRITE REG-REL FROM CAB-02 AFTER ADVANCING 2 LINES.
   176     WRITE REG-REL FROM CAB-03 AFTER ADVANCING 2 LINES.
   177     WRITE REG-REL FROM CAB-04 AFTER ADVANCING 2 LINES.
   178     WRITE REG-REL FROM CAB-05 AFTER ADVANCING 1 LINE.
   179     MOVE ZEROES TO CT-LIN.
   180
   181 DETALHE-SAIDA SECTION.
   182     MOVE CPF-TRAB   TO CPF.
   183     MOVE NOME-TRAB  TO NOME.
   184     MOVE EMAIL-TRAB TO EMAIL.
   185     WRITE REG-REL FROM DETALHE AFTER ADVANCING 1 LINE.
   186     ADD 1 TO CT-LIN.
   187
   188 FIM-SAIDA SECTION.
   189     CLOSE RELAT.
   190
   191
   192
   193
   194
   195
   196
   197
   198
   199
   200
   201
   202
   203
   204
   205
   206
* Microsoft COBOL Version 5.0        L2.4 revision 003
* (C)Copyright Microsoft Corp 1984, 1993       URN AXUPA/ZZ0/00001
*                                              REF GNB-029052003A8
*
* Total Messages:     0
* Data:        1828     Code:        1166
